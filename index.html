<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <!-- SEO TAGS (Search Engine Optimization) -->
    <title>TheSale3 Camping Store | Premium Outdoor Gear Laos</title>
    <meta name="description" content="Premium outdoor equipment for the Lao adventurer. Shop portable stoves, tents, coffee gear, and furniture. Quality tested for Laos terrain. Contact +8562054849393.">
    <meta name="keywords" content="Camping Laos, TheSale3, Vientiane Camping, Outdoor Gear Laos, Portable Stove Laos, Tent Shop Laos">
    <meta name="author" content="TheSale3">
    
    <!-- Open Graph Tags (For Facebook/WhatsApp Sharing) -->
    <meta property="og:title" content="TheSale3 Camping Store | Cloud Powered">
    <meta property="og:description" content="Premium outdoor equipment for the Lao adventurer. Click to browse our catalog.">
    <meta property="og:image" content="https://i.postimg.cc/FKL5Q4JW/489751506-1424454392283349-8154752889413656228-n.jpg">
    <meta property="og:url" content="https://thesale3.github.io/">

    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;500;600;700;800&display=swap');
        
        body {
            font-family: 'Plus Jakarta Sans', sans-serif;
            background-color: #fcfcfc;
            color: #111827;
        }

        .hero-banner {
            background: linear-gradient(rgba(0,0,0,0.5), rgba(0,0,0,0.5)), url('https://i.postimg.cc/FKL5Q4JW/489751506-1424454392283349-8154752889413656228-n.jpg');
            background-size: cover;
            background-position: center;
        }

        .nav-blur {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
        }

        .product-card {
            background: #ffffff;
            border: 1px solid #f3f4f6;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            border-radius: 24px;
        }

        .product-card:hover {
            transform: translateY(-6px);
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1);
            border-color: #e5e7eb;
        }

        .category-pill.active {
            background-color: #059669;
            color: white;
            border-color: #059669;
        }

        .modal-container {
            display: none;
            background: rgba(0,0,0,0.7);
            backdrop-filter: blur(8px);
        }

        .whatsapp-btn {
            background: #25D366;
            transition: all 0.3s ease;
        }

        .whatsapp-btn:hover {
            background: #1eb956;
            transform: scale(1.02);
        }

        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .fade-in { animation: fadeIn 0.5s ease forwards; }
    </style>
</head>
<body class="flex flex-col min-h-screen">

    <!-- Navigation -->
    <nav class="nav-blur sticky top-0 z-50 border-b border-gray-100">
        <div class="max-w-7xl mx-auto px-4 sm:px-6">
            <div class="flex justify-between items-center h-16 sm:h-20">
                <div class="flex items-center gap-3">
                    <div class="bg-black w-10 h-10 flex items-center justify-center rounded-xl cursor-pointer" onclick="toggleAdmin()">
                        <i class="fa-solid fa-mountain-sun text-white text-lg"></i>
                    </div>
                    <div class="flex flex-col">
                        <span class="font-black text-lg leading-none tracking-tight text-black uppercase">THESALE3</span>
                        <span class="text-[9px] font-bold text-emerald-600 tracking-[0.2em] uppercase">Camping Store</span>
                    </div>
                </div>

                <div class="flex items-center gap-6">
                    <a href="https://wa.me/8562054849393" target="_blank" class="flex items-center gap-2 group">
                        <i class="fa-brands fa-whatsapp text-2xl text-emerald-500 group-hover:scale-110 transition"></i>
                        <span class="hidden sm:block text-[11px] font-bold uppercase tracking-widest text-gray-900">Contact Shop</span>
                    </a>
                </div>
            </div>
        </div>
    </nav>

    <!-- Hero -->
    <header class="hero-banner h-[400px] sm:h-[500px] flex items-center justify-center text-center px-4">
        <div class="max-w-3xl">
            <h1 class="text-5xl sm:text-7xl font-black text-white mb-6 tracking-tighter drop-shadow-2xl">TheSale3 Store</h1>
            <p class="text-gray-100 text-base sm:text-xl mb-10 font-medium drop-shadow-md max-w-xl mx-auto">Premium outdoor equipment for the Lao adventurer. Quality tested for our unique terrain.</p>
            <a href="#catalog" class="bg-emerald-600 text-white px-10 py-4 rounded-full font-bold text-sm uppercase tracking-widest hover:bg-emerald-700 transition shadow-2xl inline-block">
                Start Exploring
            </a>
        </div>
    </header>

    <!-- Catalog -->
    <main id="catalog" class="max-w-7xl mx-auto px-4 sm:px-6 py-12 flex-grow w-full">
        <div class="flex flex-col lg:flex-row justify-between items-center mb-12 gap-6">
            <div id="categoryContainer" class="flex gap-2 overflow-x-auto no-scrollbar w-full lg:w-auto pb-2">
                <button onclick="filterBy('all', this)" class="category-pill active bg-emerald-600 text-white px-6 py-2.5 rounded-xl text-[10px] font-bold uppercase tracking-widest border border-transparent">All Gear</button>
                <button onclick="filterBy('coffee', this)" class="category-pill bg-white border border-gray-100 text-gray-400 px-6 py-2.5 rounded-xl text-[10px] font-bold uppercase tracking-widest hover:border-emerald-600">Coffee</button>
                <button onclick="filterBy('tents', this)" class="category-pill bg-white border border-gray-100 text-gray-400 px-6 py-2.5 rounded-xl text-[10px] font-bold uppercase tracking-widest hover:border-emerald-600">Tents</button>
                <button onclick="filterBy('cooking', this)" class="category-pill bg-white border border-gray-100 text-gray-400 px-6 py-2.5 rounded-xl text-[10px] font-bold uppercase tracking-widest hover:border-emerald-600">Cooking</button>
                <button onclick="filterBy('furniture', this)" class="category-pill bg-white border border-gray-100 text-gray-400 px-6 py-2.5 rounded-xl text-[10px] font-bold uppercase tracking-widest hover:border-emerald-600">Furniture</button>
            </div>
            
            <div class="relative w-full lg:w-72">
                <i class="fa-solid fa-magnifying-glass absolute left-4 top-1/2 -translate-y-1/2 text-gray-400 text-sm"></i>
                <input type="text" id="searchInput" oninput="searchItems()" placeholder="Search gear..." class="w-full pl-12 pr-4 py-3 rounded-2xl border-none ring-1 ring-gray-200 focus:ring-2 focus:ring-emerald-500 shadow-sm transition">
            </div>
        </div>

        <div id="productGrid" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6">
            <div class="col-span-full py-20 text-center text-gray-400">
                <i class="fa-solid fa-spinner fa-spin text-3xl mb-4"></i>
                <p id="loadingStatus">Connecting to cloud...</p>
            </div>
        </div>
    </main>

    <!-- Product Details Modal -->
    <div id="modal" class="modal-container fixed inset-0 z-[100] flex items-center justify-center p-4">
        <div class="bg-white rounded-[32px] max-w-4xl w-full overflow-hidden shadow-2xl relative flex flex-col md:flex-row max-h-[90vh]">
            <button onclick="closeModals()" class="absolute top-4 right-4 text-gray-400 hover:text-black z-20 bg-white/80 w-10 h-10 rounded-full flex items-center justify-center shadow-sm">
                <i class="fa-solid fa-xmark"></i>
            </button>
            <div class="md:w-1/2 bg-gray-50 h-64 md:h-auto overflow-hidden">
                <img id="modalImage" src="" alt="" class="w-full h-full object-cover">
            </div>
            <div class="p-8 md:p-12 md:w-1/2 flex flex-col overflow-y-auto">
                <span id="modalCategory" class="text-emerald-700 text-[10px] font-bold uppercase tracking-[0.3em] mb-4"></span>
                <h2 id="modalTitle" class="text-3xl font-black text-gray-900 mb-4 tracking-tighter"></h2>
                <p id="modalPrice" class="text-2xl font-bold text-emerald-600 mb-6 italic"></p>
                <div class="h-1 w-12 bg-emerald-600 mb-6"></div>
                <p id="modalDescription" class="text-gray-500 text-sm leading-relaxed mb-8 flex-grow"></p>
                <a id="whatsappBtn" href="#" target="_blank" class="whatsapp-btn text-white py-4 rounded-2xl font-black flex items-center justify-center gap-3 shadow-lg uppercase tracking-widest text-xs">
                    <i class="fa-brands fa-whatsapp text-2xl"></i> Chat to Buy
                </a>
            </div>
        </div>
    </div>

    <!-- Admin Panel Modal -->
    <div id="adminModal" class="modal-container fixed inset-0 z-[110] flex items-center justify-center p-4">
        <div class="bg-white rounded-3xl max-w-lg w-full p-8 shadow-2xl relative">
            <button onclick="closeModals()" class="absolute top-6 right-6 text-gray-400 hover:text-black"><i class="fa-solid fa-xmark text-xl"></i></button>
            <h2 class="text-2xl font-black mb-6">Admin Panel</h2>
            <form id="adminForm" class="space-y-4 mb-8">
                <input type="text" id="pName" placeholder="Product Name" class="w-full p-3 bg-gray-50 rounded-xl outline-none focus:ring-2 focus:ring-emerald-500 border-none" required>
                <div class="grid grid-cols-2 gap-4">
                    <input type="number" id="pPrice" placeholder="Price (LAK)" class="p-3 bg-gray-50 rounded-xl outline-none focus:ring-2 focus:ring-emerald-500 border-none" required>
                    <select id="pCategory" class="p-3 bg-gray-50 rounded-xl outline-none focus:ring-2 focus:ring-emerald-500 border-none">
                        <option value="coffee">Coffee</option>
                        <option value="tents">Tents</option>
                        <option value="cooking">Cooking</option>
                        <option value="lighting">Lighting</option>
                        <option value="furniture">Furniture</option>
                    </select>
                </div>
                <input type="url" id="pImage" placeholder="Image URL (PostImg direct link)" class="w-full p-3 bg-gray-50 rounded-xl outline-none focus:ring-2 focus:ring-emerald-500 border-none" required>
                <textarea id="pDesc" placeholder="Product Description..." class="w-full p-3 bg-gray-50 rounded-xl outline-none focus:ring-2 focus:ring-emerald-500 border-none h-20" required></textarea>
                <button type="submit" class="w-full bg-black text-white py-3 rounded-xl font-bold hover:bg-gray-800 transition shadow-lg">Save Product</button>
            </form>

            <div class="border-t pt-4">
                <h3 class="text-xs font-bold text-gray-400 uppercase tracking-widest mb-4">Live Inventory</h3>
                <div id="adminList" class="max-h-48 overflow-y-auto space-y-2 pr-2">
                    <!-- Delete list items here -->
                </div>
            </div>
        </div>
    </div>

    <footer class="bg-white border-t py-12 px-4 text-center mt-auto">
        <div class="flex justify-center items-center gap-2 mb-4 text-gray-300">
            <i class="fa-solid fa-mountain-sun"></i>
            <span class="font-bold uppercase tracking-widest text-[10px]">TheSale3 Camping Laos</span>
        </div>
        <p class="text-[10px] text-gray-400 uppercase tracking-widest">Premium Outdoor Solutions</p>
    </footer>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, signInWithCustomToken, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, collection, addDoc, onSnapshot, doc, deleteDoc } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        // Global State
        let products = [];
        let filteredProducts = [];
        let currentCat = 'all';
        let currentUser = null;

        // Configuration from Environment
        const firebaseConfig = JSON.parse(__firebase_config);
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'thesale3-camping';
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        // Path (MANDATORY RULE 1)
        const productCollection = collection(db, 'artifacts', appId, 'public', 'data', 'products');

        // Functions exposed to window
        window.toggleAdmin = () => {
            const m = document.getElementById('adminModal');
            m.style.display = m.style.display === 'flex' ? 'none' : 'flex';
        };

        window.closeModals = () => {
            document.getElementById('modal').style.display = 'none';
            document.getElementById('adminModal').style.display = 'none';
            document.body.style.overflow = 'auto';
        };

        window.filterBy = (cat, btn) => {
            currentCat = cat;
            document.querySelectorAll('.category-pill').forEach(b => {
                b.classList.remove('active', 'bg-emerald-600', 'text-white');
                b.classList.add('bg-white', 'text-gray-400', 'border-gray-100');
            });
            btn.classList.add('active', 'bg-emerald-600', 'text-white');
            btn.classList.remove('bg-white', 'text-gray-400', 'border-gray-100');
            applyFilters();
        };

        window.searchItems = () => {
            applyFilters();
        };

        window.openDetails = (id) => {
            const p = products.find(x => x.id === id);
            if (!p) return;
            document.getElementById('modalTitle').innerText = p.name;
            document.getElementById('modalCategory').innerText = p.category;
            document.getElementById('modalPrice').innerText = `LAK ${Number(p.price).toLocaleString()}`;
            document.getElementById('modalDescription').innerText = p.description;
            document.getElementById('modalImage').src = p.image;
            document.getElementById('whatsappBtn').href = `https://wa.me/8562054849393?text=Sabaidee! I am interested in: ${p.name}`;
            document.getElementById('modal').style.display = 'flex';
            document.body.style.overflow = 'hidden';
        };

        window.removeItem = async (id) => {
            if (!currentUser) return;
            if(!confirm("Delete this product?")) return;
            try {
                await deleteDoc(doc(db, 'artifacts', appId, 'public', 'data', 'products', id));
            } catch (e) { console.error("Delete failed:", e); }
        };

        function applyFilters() {
            const search = document.getElementById('searchInput').value.toLowerCase();
            filteredProducts = products.filter(p => {
                const matchesSearch = p.name.toLowerCase().includes(search);
                const matchesCat = currentCat === 'all' || p.category === currentCat;
                return matchesSearch && matchesCat;
            });
            render();
        }

        function render() {
            const grid = document.getElementById('productGrid');
            const adminList = document.getElementById('adminList');
            
            grid.innerHTML = filteredProducts.map(p => `
                <div class="product-card group overflow-hidden flex flex-col cursor-pointer fade-in" onclick="openDetails('${p.id}')">
                    <div class="h-64 overflow-hidden relative bg-gray-50">
                        <img src="${p.image}" class="w-full h-full object-cover group-hover:scale-105 transition-transform duration-700" onerror="this.src='https://via.placeholder.com/400x300?text=No+Image'">
                    </div>
                    <div class="p-8 flex flex-col flex-grow text-left">
                        <span class="text-[9px] font-bold text-gray-400 uppercase tracking-widest mb-2">${p.category}</span>
                        <h3 class="font-bold text-lg mb-1 text-gray-900 group-hover:text-emerald-700 transition-colors tracking-tight">${p.name}</h3>
                        <p class="text-base font-bold text-emerald-600 mb-6 italic">LAK ${Number(p.price).toLocaleString()}</p>
                        <div class="mt-auto flex items-center gap-2 text-[10px] font-bold uppercase tracking-widest text-gray-900">
                            Check Details <i class="fa-solid fa-arrow-right-long text-emerald-600 group-hover:translate-x-1 transition"></i>
                        </div>
                    </div>
                </div>
            `).join('');

            if(filteredProducts.length === 0) {
                grid.innerHTML = '<div class="col-span-full py-20 text-center text-gray-400 italic">No equipment found matching your criteria.</div>';
            }

            adminList.innerHTML = products.map(p => `
                <div class="flex items-center justify-between p-2 bg-gray-50 rounded-lg text-[11px]">
                    <span class="font-bold truncate w-32">${p.name}</span>
                    <button onclick="removeItem('${p.id}')" class="text-red-400 hover:text-red-600 transition p-2">
                        <i class="fa-solid fa-trash-can"></i>
                    </button>
                </div>
            `).join('');
        }

        // Firebase Auth & Initial Data Loading (RULE 3)
        const init = async () => {
            // STEP 1: AUTH FIRST
            try {
                if (typeof __initial_auth_token !== 'undefined' && __initial_auth_token) {
                    await signInWithCustomToken(auth, __initial_auth_token);
                } else {
                    await signInAnonymously(auth);
                }
            } catch (authError) {
                console.error("Auth Failure:", authError);
                document.getElementById('loadingStatus').innerText = "Security check failed. Please refresh.";
                return;
            }

            // STEP 2: LISTEN FOR STATE CHANGES
            onAuthStateChanged(auth, (user) => {
                currentUser = user;
                if (user) {
                    // STEP 3: START QUERIES ONLY AFTER AUTH (RULE 3 GUARD)
                    onSnapshot(productCollection, (snapshot) => {
                        products = snapshot.docs.map(d => ({ id: d.id, ...d.data() }));
                        applyFilters();
                    }, (err) => {
                        console.error("Firestore Error Details:", err);
                        document.getElementById('loadingStatus').innerText = "Database connection issue. Check permissions.";
                    });
                } else {
                    console.warn("No authenticated user session.");
                }
            });
        };

        // Form Submission
        document.getElementById('adminForm').onsubmit = async (e) => {
            e.preventDefault();
            if (!currentUser) return;

            const payload = {
                name: document.getElementById('pName').value,
                price: Number(document.getElementById('pPrice').value),
                category: document.getElementById('pCategory').value,
                image: document.getElementById('pImage').value,
                description: document.getElementById('pDesc').value,
                createdAt: new Date().toISOString()
            };

            try {
                await addDoc(productCollection, payload);
                document.getElementById('adminForm').reset();
                window.toggleAdmin();
            } catch (err) { 
                console.error("Save Error:", err);
                alert("Could not save. Check if you have permission to add products.");
            }
        };

        // Initialize App
        window.onload = () => {
            init();
        };

    </script>
</body>
</html>
